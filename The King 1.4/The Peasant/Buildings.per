;Buildings

	;Economic Buildings

        ;Town Centers

		(defrule
			(building-type-count-total town-center < 1)
            (can-build-with-escrow town-center)
		=>
            (release-escrow wood)
            (release-escrow stone)
			(build town-center)
		)

        (defrule
			(building-type-count-total town-center < 3)
            (building-type-count-total castle >= 1)
            (can-build-with-escrow town-center)
		=>
            (release-escrow wood)
            (release-escrow stone)
			(build town-center)
		)

        ;Houses

        (defrule
            (building-type-count-total town-center >= 1)
            (housing-headroom < 4)
            (population-headroom > 3)
            (can-build house)
        =>
            (build house)
        )

        ;Lumber camps
        
        (defrule
            (building-type-count-total lumber-camp == 0)
			(unit-type-count villager > 6)
			(resource-found wood)
			(can-build lumber-camp)
		=>
			(build lumber-camp)
		)

        (defrule
            (building-type-count-total town-center >= 1)
            (building-type-count-total lumber-camp < 2)
            (building-type-count-total market >= 1)
			(current-age >= feudal-age)
			(can-build lumber-camp)
		=>
			(build lumber-camp)
		)

        ;Mills

        (defrule
			(building-type-count-total town-center >= 1)
            (building-type-count-total mill == 0)
            (unit-type-count villager > 6)
            (or (unit-type-count 594 < 2) (building-type-count-total lumber-camp >= 1))
			(resource-found food)
            (can-build mill)
		=>
			(build mill)
		)

        ;Mining camps

        (defrule
			(building-type-count-total town-center >= 1)
            (building-type-count-total lumber-camp >= 1)
            (building-type-count-total mining-camp == 0)
			(resource-found gold)
            (can-build mining-camp)
		=>
			(build mining-camp)
            (chat-to-all "Building mining camp")
		)

        (defrule
			(building-type-count-total town-center >= 1)
            (building-type-count-total lumber-camp >= 1)
            (building-type-count-total mining-camp < 2)
			(resource-found stone)
            (can-build mining-camp)
		=>
			(build mining-camp)
		)

        ;Farms

        (defrule
			(building-type-count-total town-center >= 1)
            (building-type-count-total lumber-camp >= 1)
            (unit-type-count 594 <= 1)
            (idle-farm-count < 2)
            (current-age == dark-age)
            (unit-type-count villager <= 23)
            (can-build farm)
		=>
			(build farm)
		)

        (defrule
			(building-type-count-total town-center >= 1)
            (unit-type-count 594 <= 1)
            (idle-farm-count < 2)
            (current-age == dark-age)
            (building-type-count-total mining-camp >= 2)
            (unit-type-count villager > 24)
            (can-build farm)
		=>
			(build farm)
		)

        (defrule
			(building-type-count-total town-center >= 1)
            (building-type-count-total market >= 1)
            (idle-farm-count < 2)
            (current-age == feudal-age)
            (can-build farm)
		=>
			(build farm)
		)

        (defrule
			(building-type-count-total town-center >= 1)
            (idle-farm-count < 2)
            (current-age >= castle-age)
            (can-build farm)
		=>
			(build farm)
		)

        (defrule
			(building-type-count-total town-center >= 1)
            (idle-farm-count < 2)
            (game-time > 2400)
            (can-build farm)
		=>
			(build farm)
		)

        ;Blacksmiths

        (defrule
            (building-type-count-total town-center >= 1)
            (building-type-count-total blacksmith < 1)
            (can-build blacksmith)
        =>
            (build blacksmith)
            (chat-to-all "Building blacksmith")
        )

        ;Markets

        (defrule
            (building-type-count-total town-center >= 1)
            (building-type-count-total blacksmith >= 1)
            (building-type-count-total market < 1)
            (can-build market)
        =>
            (build market)
            (chat-to-all "Building market")
        )

        ;Universities

        (defrule
            (building-type-count-total town-center >= 1)
            (building-type-count-total siege-workshop >= 1)
            (building-type-count-total university < 1)
            (can-build university)
        =>
            (build university)
            (chat-to-all "Building university")
        )

    ;Military Buildings

        (defrule
            (building-type-count-total town-center >= 1)
            (building-type-count-total barracks < 1)
            (current-age >= feudal-age)
            (can-build barracks)
        =>
            (build barracks)
            (chat-to-all "Building barracks")
        )

        (defrule
            (building-type-count-total town-center >= 1)
            (building-type-count-total archery-range < 1)
            (can-build archery-range)
        =>
            (build archery-range)
            (chat-to-all "Building archery range")
        )

        (defrule
            (building-type-count-total town-center >= 1)
            (building-type-count-total stable < 1)
            (can-build stable)
        =>
            (build stable)
            (chat-to-all "Building stable")
        )

        ;Siege Workshop

        (defrule
            (building-type-count-total town-center >= 1)
            (building-type-count-total monastery >= 1)
            (building-type-count-total siege-workshop < 1)
            (can-build siege-workshop)
        =>
            (build siege-workshop)
            (chat-to-all "Building siege workshop")
        )

        ;Monastery

        (defrule
            (building-type-count-total town-center >= 1)
            (building-type-count-total monastery < 1)
            (can-build monastery)
        =>
            (build monastery)
            (chat-to-all "Building monastery")
        )

        ;Castle

        (defrule
            (can-build castle)
        =>
            (build castle)
            (chat-to-all "Building castle")
        )
        
        (defrule
            (can-build watch-tower-line)
            (building-type-count-total watch-tower-line < 5)
        =>
            (build watch-tower-line)
        )

